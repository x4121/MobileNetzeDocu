\section{OpenBTS}
\label{sec:openbts}

% Software-Defined Radio Platform
% Ettus Research USRP 2 
% Ubuntu 14.04

Im Rahmen der Blockveranstaltung ``Mobile Netze'' im Sommersemester 2015 bei Herrn Wischhof sollte eine praktische Anwendung bezüglich GSM-, UMTS- oder WLAN-Netzen auf echter Hardware umgesetzt werden. Die von uns gewählte Aufgabe war das Einrichten eines fakultätseigenen Mobilfunknetz mit GSM.
Zur Verfügung stand uns dafür als \SDR ein \USRP von \emph{Ettus Research} \footnote{\url{http://www.ettus.com/content/files/07495_Ettus_N200-210_DS_Flyer_HR_1.pdf}} auf welchem wir mit OpenBTS ein \GSM-Netz aufsetzten.

\subsection{Installation}
\label{sec:installation}

Zur Installation und initialen Einrichtung von OpenBTS haben wir uns weitestgehend an die Anleitung des auf \url{http://openbts.org} verlinkten Git-Repository \footnote{\url{https://github.com/RangeNetworks/dev/wiki}} gehalten.\\Da die Ubuntu-Version auf den Laborrechnern bereits sehr stark veraltet war und durch fehlerhafte Konfigurationen nicht mehr sehr stabil lief, mussten wir diesen zunächst neu aufsetzen. Anschließend haben wir Git installiert und das Git-Repository mit allen
Abhängigkeiten auf den Laborrechner geklont, den aktuellen Branch ausgewählt und kompiliert.

\begin{lstlisting}[language=bash]
git clone http://github.com/RangeNetworks/dev
cd dev
./clone.sh
./switchto.sh master
./build.sh
\end{lstlisting}

Nachdem die einzelnen Komponenten kompiliert wurden, konnte man diese und die dazu benötigten Abhängigkeiten auf dem Laborrechner installieren.

\begin{lstlisting}
cd BUILD-*
sudo dpkg -i *.deb
sudo apt-get -f install
\end{lstlisting}

Abschließend musste man nur noch die einzelnen Komponenten starten. Da die Komponenten in Upstart eingetragen wurden, konnte man auch einfach den Laborrechner neustarten.

\subsection{Inbetriebnahme}
\label{sec:inbetriebnahme}

\subsection{Konfiguration}
\label{sec:konfiguration}

\subsection{Herausforderungen}
Nachdem die Konfiguration nach \autoref{sec:konfiguration} erfolgte, konnten sich Mobilteile im eigenen Netz registrieren und wurden durch die erstellte Willkommensnachricht begrüßt.\todo{Bild einfügen}
Über das OpenBTS-\CLI konnten die angemeldeten Teilnehmer mithilfe des Befehls \inlinecode{tmsis} anhand ihrer \IMSI identifiziert werden. Mit dem Befehl \inlinecode{sendsms <IMSI> <sourceAddress> <message text>} kann an die \emph{\IMSI} eine \SMS-Nachricht (\emph{message text}) mit dem Absender \emph{sourceAddress} versandt werden.

Hierbei ließen sich bereits Inkonsistenzen in der Auslieferung der erstellten \SMS feststellen. Nach der erfolgreichen Integration von OpenBTS mit Asterisk verblieb sowohl die Auslieferungsrate von \SMS-Nachrichten auf die hinterlegte Rufnummer auf einem niedrigen Niveau unter zehn Prozent als auch das erfolgreiche Pagen der Mobilteile.
\subsubsection{Konsistenter Verbindungsaufbau}
Nach tagelangem Konfigurieren ließ sich zwar keine Verbesserung in der Zustellrate von \SMS-Nachrichten und einem konsistenten Rufaufbau erzielen, dennoch führten die getätigten Beobachtungen letztendlich zur Fehlerfindung. War das zu pagende Gerät weiter entfernt als unser normaler Laborarbeitsplatz, so stieg die Zustellrate signifikant an.
Die Ursache hierfür lag demnach in der zu hohen Sendeleistung der Basisstation.

Durch ein Absenken der voreingestellten minimalen (\emph{GSM.MS.Power.Min}) und maximalen (\emph{GSM.MS.Power.Max}) Leistungsgrenzen in der Konfiguration von \SI{5}{dBm} beziehungsweise \SI{33}{dBm} auf \SI{0}{dBm} respektive \SI{1}{dBm} verbesserte sich der Verbindungsaufbau nochmals. 
Die im Labor beste Verbindungsrate konnte durch das zusätzliche Anbringen eines Dämpfungsglieds von \SI{10}{dB} an der Transmit-Antenne und der vorhin genannten Leistungsgrenzen erzielt werden.

\subsubsection{Automatisierte Benutzeranmeldung}
Wie in \autoref{sec:konfiguration} beschrieben, wurden die Teilnehmer mit deren \IMSI und gewünschter Telefonnummer in die Asterisk-Datenbank von Hand eingetragen. Selbst im Laborversuch mit einer geringen Geräteanzahl stellte sich dies als zu unkomfortabel heraus.
Aus diesem Grund wurde die bestehende Funktionalität von OpenBTS und Asterisk über die Konfiguration entsprechend der Vorstellung der Gruppenmitgliedern angepasst.

Die Willkommensnachricht weist die neuen Benutzer an, mit einer gewünschten Telefonnummer per \SMS-Nachricht zu antworten, damit ihnen diese zugeteilt werden kann. Wird eine bereits verwendete oder ungültige Rufnummer angegeben, so wird dies dem Benutzer wiederum per \SMS-Nachricht mitgeteilt.
Erfolgt die Rufnummernbindung an die \IMSI, so wird diese Zuordnung in der Asterisk-Datenbank in \emph{/var/lib/asterisk/sqlite3dir/sqlite3.db} persistiert.

\subsubsection{Aktualisierung der registrierten Benutzer}
Die zu erstellende Anwendung (siehe \todo{add section reference}) fordert eine Aktualisierung der aktiv angemeldeten Benutzer. Dies stellt eine vereinfachte Form eines Präsenzdienstes darstellt.\\
Die bestehende Konfiguration aus \autoref{sec:konfiguration} widerspricht mit den voreingestellten Standardwerten klar dieser Forderung. 
Im Labor wurden inaktive Geräte nicht auf Existenz überprüft, d.~h. solange ein \UE nicht selbständig aktiv eine Verbindung aufbaute, wurde die zugehörige \IMSI in der Ausgabe des \inlinecode{tmsis}-Befehls nicht aktualisiert. Um diese Malaise \todo{eine was?} zu mindern, werden die folgenden Parameter angepasst.\\
Mit einem Konfigurationswert \inlinecode{1} für \inlinecode{Control.LUR.QueryIMEI} wird von jeder Mobilstation bei einem initialen \LUR die \IMEI abgefragt.\\
Durch das Setzten von \inlinecode{Control.LUR.SendTMSIs} auf \inlinecode{1} werden neue \TMSI-Zuweisungen an die Mobilgeräte gesendet, die sich im Netzwerk anmelden dürfen (siehe \autoref{sec:konfiguration} \inlinecode{Control.LUR.OpenRegistration}). Diese Änderungen werden in die \TMSI-Datenbank gespeichert, die über das Konfigurationselement \inlinecode{Control.Reporting.\allowbreak TMSITable} eingestellt werden kann, und können somit direkt aus der Datenbank ausgelesen werden oder über die Ausgabe des Befehls \inlinecode{tmsis}.\\
Des Weiteren muss der Zeitschritt für die Registrierungsgültigkeit in Minuten \inlinecode{GSM.Timer.T3212} konfiguriert werden, der auf ein vielfaches von sechs und mindestens dieselbe Zahl gestellt werden kann. Da die Konfigurationsoption \inlinecode{SIP.RegistrationPeriod}, die eine Registrierungszeitspanne in Minuten angibt, echt größer dem \inlinecode{GSM.Timer.T3212}-Wert sein muss, wird diese auf 7 [Minuten] und der letztgenannte auf 6 [Minuten] festgelegt.\\
Mit dieser veränderten Konfiguration werden inaktive Mobilgeräte nach spätestens sieben Minuten als \emph{außer Reichweite} oder \emph{im Stand-by} erkannt, womit der Präsenzdienst seine Funktion mit einer zeitlichen Untergrenze von eben erwähnten sieben Minuten erfüllen kann.
